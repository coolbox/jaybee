<head>
  <title>jaybee</title>
  <script src="//connect.soundcloud.com/sdk.js"></script>
  <script>
    SC.initialize({
      client_id: "bddbc50b3432a6c8034ea30a8f73ee1c",
      redirect_uri: "http://dev.jaybee.com:3000/callback.html"
    });
  </script>
</head>

<body>
  {{> header}}
  {{#if currentUser}}
    {{> loggedIn}}
  {{else}}
    {{> loggedOut}}
  {{/if}}
</body>

<template name="header">
  {{#if currentUser}}
    <img src="{{currentUser.services.soundcloud.avatar_url}}" width="50"/>
  {{/if}}
  {{> loginButtons}}
</template>

<template name="loggedIn">
  <section>
    <aside class="search_col">
      {{> search}}
      {{> searchResults}}
    </aside><article class="playlist_col">
      {{> controls}}
      {{> now_playing }}
      {{> playlist}}
    </article>
  </section>
</template>

<template name="loggedOut">
  <h1>Welcome to Jaybee</h1>
  <p>Log in with Soundcloud to get tune in.</p>
</template>

<template name="controls">
  <h2>Controls:</h2>
  <ul>
    <li><a data-control="play">Play</a></li>
    <li><a data-control="pause">Pause</a></li>
    <li><a data-control="next">Next</a></li>
  </ul>
</template>

<template name="now_playing">
  <h2>Now Playing:</h2>
  {{#with now_playing}}
    <div>
      <img src="{{now_playing.artwork_url}}" width="50" />
      {{title}} - {{username}} <span><small>({{length duration}}) - ({{elapsed}})</small></span>
      <ul>
        <li>Added by: {{added_by.profile.name}}</li>
        <li>
          <a class="favourite" data-track-id="{{track_id}}">Favourite</a>
        </li>
        <li><a href="{{permalink_url}}" target="_blank">Soundcloud</a></li>
      </ul>
    </div>
  {{/with}}
</template>

<template name="playlist">
  <h2>Playlist</h2>
  {{#each tracks}}
    <li>
      <img src="{{artwork_url}}" width="50" />
      {{title}} - {{username}} <span><small>({{length duration}})</small></span>
      <ul>
        <li>Added by: {{added_by.profile.name}}</li>
        <li>
          <a class="remove" data-track-id="{{_id}}">Remove</a>
        </li>
        <li>
          <a class="favourite" data-track-id="{{track_id}}">Favourite</a>
        </li>
        <li>
          <a href="{{permalink_url}}" target="_blank">Soundcloud</a>
        </li>
      </ul>
    </li>
  {{/each}}
</template>

<template name="search">
  <h2>Search:</h2>
  <form id="search_form">
    <input class="search" type="text" name="search" placeholder="Search for a trackâ€¦" />
  </form>
</template>

<template name="searchResults">
  <ul>
    {{#each results}}
      <li>
        <a class="add" data-track-id="{{id}}">
          <img src="{{artwork_url}}" width="50" />
        </a>
        <p>{{title}} - {{user.username}} <span><small>({{length duration}})</small></span></p>
        <ul>
          <li>
            <a class="add" data-track-id="{{id}}">Add</a>
            <a href="{{permalink_url}}" target="_blank">Soundcloud</a>
          </li>
        </ul>
      </li>
    {{/each}}
  </ul>
</template>